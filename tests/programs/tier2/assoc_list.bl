@prelude(script)

// Tier 2: Association list (key-value pairs) â€” records, lists, HOFs

type Entry = { key: String, value: Int }

fn make_entry(k: String, v: Int) -> Entry = Entry { key: k, value: v }

// Look up a key in an association list
fn lookup(entries: List<Entry>, k: String) -> Option<Int> = {
  let found = List.find(entries, |e| e.key == k)
  Option.map(found, |e| e.value)
}

// Insert or update a key
fn insert_entry(entries: List<Entry>, k: String, v: Int) -> List<Entry> = {
  let without = List.filter(entries, |e| e.key != k)
  List.concat([make_entry(k, v)], without)
}

fn main!() -> {Console} () = {
  let db = []
  let db = insert_entry(db, "alice", 42)
  let db = insert_entry(db, "bob", 17)
  let db = insert_entry(db, "charlie", 99)

  Console.println!("alice: ${Option.unwrap_or(lookup(db, "alice"), -1)}")
  Console.println!("bob: ${Option.unwrap_or(lookup(db, "bob"), -1)}")
  Console.println!("dave: ${Option.unwrap_or(lookup(db, "dave"), -1)}")

  let db = insert_entry(db, "alice", 100)
  Console.println!("alice updated: ${Option.unwrap_or(lookup(db, "alice"), -1)}")
  Console.println!("size: ${List.length(db)}")
}
