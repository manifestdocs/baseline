@prelude(script)

// Tier 2: Association list (key-value pairs) â€” records, lists, HOFs

type Entry = { key: String, value: Int }

make_entry : (String, Int) -> Entry
make_entry = |k, v| Entry { key: k, value: v }

// Look up a key in an association list
lookup : (List<Entry>, String) -> Option<Int>
lookup = |entries, k| {
  let found = List.find(entries, |e| e.key == k)
  Option.map(found, |e| e.value)
}

// Insert or update a key
insert_entry : (List<Entry>, String, Int) -> List<Entry>
insert_entry = |entries, k, v| {
  let without = List.filter(entries, |e| e.key != k)
  List.concat([make_entry(k, v)], without)
}

main! : () -> {Console} ()
main! = || {
  let db = []
  let db = insert_entry(db, "alice", 42)
  let db = insert_entry(db, "bob", 17)
  let db = insert_entry(db, "charlie", 99)

  Console.println!("alice: ${Option.unwrap_or(lookup(db, "alice"), -1)}")
  Console.println!("bob: ${Option.unwrap_or(lookup(db, "bob"), -1)}")
  Console.println!("dave: ${Option.unwrap_or(lookup(db, "dave"), -1)}")

  let db = insert_entry(db, "alice", 100)
  Console.println!("alice updated: ${Option.unwrap_or(lookup(db, "alice"), -1)}")
  Console.println!("size: ${List.length(db)}")
}
