// Algebraic effects conformance tests

// Test 1: Simple handle body returns value (no effects fired)
test "body without effects" = handle { 42 } with {
  Console.println!(msg, resume) -> resume(())
} == 42

// Test 2: Abort handler returns handler value  
test "abort handler" = handle {
  Console.println!("hello")
  42
} with {
  Console.println!(msg) -> -1
} == -1

// Test 3: Resume handler continues body
test "resume handler returns body value" = handle {
  Console.println!("hello")
  42
} with {
  Console.println!(msg, resume) -> resume(())
} == 42

// Test 4: Multiple effects with resume
test "multi effect resume" = handle {
  Console.println!("a")
  Console.println!("b")
  100 + 200
} with {
  Console.println!(msg, resume) -> resume(())
} == 300

// Test 5: Handler can transform the resume value
test "handler transforms resume" = handle {
  Console.println!("hello")
  10
} with {
  Console.println!(msg, resume) -> resume(())
} == 10

// Test 6: Body with computation after effect
test "body computation after effect" = handle {
  Console.println!("start")
  let x = 10
  let y = 20
  x + y
} with {
  Console.println!(msg, resume) -> resume(())
} == 30

// Test 7: Abort handler short-circuits body
test "abort short circuits" = handle {
  Console.println!("first")
  Console.println!("second")
  Console.println!("third")
  999
} with {
  Console.println!(msg) -> -1
} == -1
