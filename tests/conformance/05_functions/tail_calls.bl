@prelude(core)

// Conformance: tail call optimization
// Verifies TCO works end-to-end through the compiler pipeline.
// Without TCO, these would hit MAX_CALL_DEPTH (1024) and crash.

fn countdown(n: Int) -> Int = if n <= 0 then 0 else countdown(n - 1)

fn sum_acc(n: Int, acc: Int) -> Int = if n <= 0 then acc else sum_acc(n - 1, acc + n)

fn factorial_acc(n: Int, acc: Int) -> Int = if n <= 1 then acc else factorial_acc(n - 1, n * acc)

test "deep recursion - countdown 100000" = countdown(100000) == 0
test "deep recursion - sum with accumulator" = sum_acc(100000, 0) == 5000050000
test "tail-recursive factorial" = factorial_acc(10, 1) == 3628800
